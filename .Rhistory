Blup=data.frame(Blup)
Blup = Blup %>% filter(grpvar != "MALE")
Blup = Blup %>% filter(grpvar != "LINE")
Blup.index = order(Blup$condval, decreasing=T)
Blup = Blup[Blup.index,]
head(Blup,10)
BV.HSIdentical.df = fread(paste0(hdp,"BV.HSIdentical.df.csv"))
name="Yield"
#lmerBV = function(){
######################################################
BV.HSIdentical.df = BV.HSIdentical.df %>% filter(Plot.Discarded != "Yes",
Plot.Status != "3 - Bad" )
BV.HSIdentical.df.expmean = aggregate(BV.HSIdentical.df[,"Yield"],
list(BV.HSIdentical.df$FEMALE),
mean,na.rm=T)
# #bv.mean = mean(BV.HSIdentical.df$Yield,na.rm=T)
colnames(BV.HSIdentical.df.expmean) = c("FEMALE","Yieldmean")
BV.HSIdentical.df = left_join(BV.HSIdentical.df, BV.HSIdentical.df.expmean, by="FEMALE" )
#BV.HSIdentical.df$Yieldmean = NA
BV.HSIdentical.df$Yield = ifelse(is.na(BV.HSIdentical.df$Yield), BV.HSIdentical.df$Yieldmean,BV.HSIdentical.df$Yield)
BV.HSIdentical.df = data.frame(BV.HSIdentical.df)
BV.HSIdentical.df$feature = BV.HSIdentical.df[,name]
male.rmdups = data.frame(inbred = BV.HSIdentical.df[!duplicated(BV.HSIdentical.df$MALE), c("MALE","LINE" )] )
female.rmdups = data.frame(inbred = BV.HSIdentical.df[!duplicated(BV.HSIdentical.df$FEMALE), c("FEMALE","LINE" )] )
#
#   totalInbreds = rbind(male.rmdups, female.rmdups)
# totalInbreds = data.frame(totalInbreds)
# totalInbreds = totalInbreds[!duplicated(totalInbreds$inbred),]
# totalInbreds = data.frame(totalInbreds)
maleinbreds = anti_join(male.rmdups,female.rmdups)
maleinbreds.2 = anti_join(male.rmdups,maleinbreds)
malesubset <- BV.HSIdentical.df[which(BV.HSIdentical.df$MALE %in% maleinbreds$inbred.MALE),]
#femalesubset.2 <- BV.HSIdentical.df[which(BV.HSIdentical.df$FEMALE %in% femaleinbreds.2$inbred.FEMALE),]
BV.HSIdentical.df.2 = BV.HSIdentical.df[,c(1:29,31,30,32:35)]
colnames(BV.HSIdentical.df.2)[c(30:31)] = c("MALE","FEMALE")
BV.HSIdentical.df = rbind(BV.HSIdentical.df.2,BV.HSIdentical.df)
BV.HSIdentical.df = data.frame(BV.HSIdentical.df)
FEMALE = length(levels(as.factor(BV.HSIdentical.df$FEMALE)))
MALE = length(levels(as.factor(BV.HSIdentical.df$MALE)))
p95 <- quantile(BV.HSIdentical.df$feature, 0.975, na.rm=T)
p05 <- quantile(BV.HSIdentical.df$feature, 0.025, na.rm=T)
# BV.HSIdentical.df <- BV.HSIdentical.df %>% filter(feature <= p95,
#                                                   feature >= p05)
DIBV = lmer(formula = feature ~ (1|FEMALE) + (YEAR) ,
na.action='na.omit', REML = T,
control = lmerControl(
sparseX = T),
data = BV.HSIdentical.df[,c("YEAR","FIELD","MALE","FEMALE","feature","LINE")] )
# 136
# 1026
summary(DIBV)
Blup = ranef(DIBV)
Blup=data.frame(Blup)
Blup = Blup %>% filter(grpvar != "MALE")
Blup = Blup %>% filter(grpvar != "LINE")
Blup.index = order(Blup$condval, decreasing=T)
Blup = Blup[Blup.index,]
head(Blup,10)
BV.HSIdentical.df = fread(paste0(hdp,"BV.HSIdentical.df.csv"))
name="Yield"
#lmerBV = function(){
######################################################
BV.HSIdentical.df = BV.HSIdentical.df %>% filter(Plot.Discarded != "Yes",
Plot.Status != "3 - Bad" )
BV.HSIdentical.df.expmean = aggregate(BV.HSIdentical.df[,"Yield"],
list(BV.HSIdentical.df$FEMALE),
mean,na.rm=T)
# #bv.mean = mean(BV.HSIdentical.df$Yield,na.rm=T)
colnames(BV.HSIdentical.df.expmean) = c("FEMALE","Yieldmean")
BV.HSIdentical.df = left_join(BV.HSIdentical.df, BV.HSIdentical.df.expmean, by="FEMALE" )
#BV.HSIdentical.df$Yieldmean = NA
BV.HSIdentical.df$Yield = ifelse(is.na(BV.HSIdentical.df$Yield), BV.HSIdentical.df$Yieldmean,BV.HSIdentical.df$Yield)
BV.HSIdentical.df = data.frame(BV.HSIdentical.df)
BV.HSIdentical.df$feature = BV.HSIdentical.df[,name]
male.rmdups = data.frame(inbred = BV.HSIdentical.df[!duplicated(BV.HSIdentical.df$MALE), c("MALE","LINE" )] )
female.rmdups = data.frame(inbred = BV.HSIdentical.df[!duplicated(BV.HSIdentical.df$FEMALE), c("FEMALE","LINE" )] )
#
#   totalInbreds = rbind(male.rmdups, female.rmdups)
# totalInbreds = data.frame(totalInbreds)
# totalInbreds = totalInbreds[!duplicated(totalInbreds$inbred),]
# totalInbreds = data.frame(totalInbreds)
maleinbreds = anti_join(male.rmdups,female.rmdups)
maleinbreds.2 = anti_join(male.rmdups,maleinbreds)
malesubset <- BV.HSIdentical.df[which(BV.HSIdentical.df$MALE %in% maleinbreds$inbred.MALE),]
#femalesubset.2 <- BV.HSIdentical.df[which(BV.HSIdentical.df$FEMALE %in% femaleinbreds.2$inbred.FEMALE),]
BV.HSIdentical.df.2 = BV.HSIdentical.df[,c(1:29,31,30,32:35)]
colnames(BV.HSIdentical.df.2)[c(30:31)] = c("MALE","FEMALE")
BV.HSIdentical.df = rbind(BV.HSIdentical.df.2,BV.HSIdentical.df)
BV.HSIdentical.df = data.frame(BV.HSIdentical.df)
FEMALE = length(levels(as.factor(BV.HSIdentical.df$FEMALE)))
MALE = length(levels(as.factor(BV.HSIdentical.df$MALE)))
p95 <- quantile(BV.HSIdentical.df$feature, 0.98, na.rm=T)
p05 <- quantile(BV.HSIdentical.df$feature, 0.02, na.rm=T)
BV.HSIdentical.df <- BV.HSIdentical.df %>% filter(feature <= p95,
feature >= p05)
DIBV = lmer(formula = feature ~ (1|FEMALE) + (YEAR) ,
na.action='na.omit', REML = T,
control = lmerControl(
sparseX = T),
data = BV.HSIdentical.df[,c("YEAR","FIELD","MALE","FEMALE","feature","LINE")] )
# 136
# 1026
summary(DIBV)
Blup = ranef(DIBV)
Blup=data.frame(Blup)
Blup = Blup %>% filter(grpvar != "MALE")
Blup = Blup %>% filter(grpvar != "LINE")
Blup.index = order(Blup$condval, decreasing=T)
Blup = Blup[Blup.index,]
head(Blup,10)
BV.HSIdentical.df = fread(paste0(hdp,"BV.HSIdentical.df.csv"))
name="Yield"
#lmerBV = function(){
######################################################
BV.HSIdentical.df = BV.HSIdentical.df %>% filter(Plot.Discarded != "Yes",
Plot.Status != "3 - Bad" )
BV.HSIdentical.df.expmean = aggregate(BV.HSIdentical.df[,"Yield"],
list(BV.HSIdentical.df$FEMALE),
mean,na.rm=T)
# #bv.mean = mean(BV.HSIdentical.df$Yield,na.rm=T)
colnames(BV.HSIdentical.df.expmean) = c("FEMALE","Yieldmean")
BV.HSIdentical.df = left_join(BV.HSIdentical.df, BV.HSIdentical.df.expmean, by="FEMALE" )
#BV.HSIdentical.df$Yieldmean = NA
BV.HSIdentical.df$Yield = ifelse(is.na(BV.HSIdentical.df$Yield), BV.HSIdentical.df$Yieldmean,BV.HSIdentical.df$Yield)
BV.HSIdentical.df = data.frame(BV.HSIdentical.df)
BV.HSIdentical.df$feature = BV.HSIdentical.df[,name]
male.rmdups = data.frame(inbred = BV.HSIdentical.df[!duplicated(BV.HSIdentical.df$MALE), c("MALE","LINE" )] )
female.rmdups = data.frame(inbred = BV.HSIdentical.df[!duplicated(BV.HSIdentical.df$FEMALE), c("FEMALE","LINE" )] )
#
#   totalInbreds = rbind(male.rmdups, female.rmdups)
# totalInbreds = data.frame(totalInbreds)
# totalInbreds = totalInbreds[!duplicated(totalInbreds$inbred),]
# totalInbreds = data.frame(totalInbreds)
maleinbreds = anti_join(male.rmdups,female.rmdups)
maleinbreds.2 = anti_join(male.rmdups,maleinbreds)
malesubset <- BV.HSIdentical.df[which(BV.HSIdentical.df$MALE %in% maleinbreds$inbred.MALE),]
#femalesubset.2 <- BV.HSIdentical.df[which(BV.HSIdentical.df$FEMALE %in% femaleinbreds.2$inbred.FEMALE),]
BV.HSIdentical.df.2 = BV.HSIdentical.df[,c(1:29,31,30,32:35)]
colnames(BV.HSIdentical.df.2)[c(30:31)] = c("MALE","FEMALE")
BV.HSIdentical.df = rbind(BV.HSIdentical.df.2,BV.HSIdentical.df)
BV.HSIdentical.df = data.frame(BV.HSIdentical.df)
FEMALE = length(levels(as.factor(BV.HSIdentical.df$FEMALE)))
MALE = length(levels(as.factor(BV.HSIdentical.df$MALE)))
p95 <- quantile(BV.HSIdentical.df$feature, 0.99, na.rm=T)
p05 <- quantile(BV.HSIdentical.df$feature, 0.01, na.rm=T)
BV.HSIdentical.df <- BV.HSIdentical.df %>% filter(feature <= p95,
feature >= p05)
DIBV = lmer(formula = feature ~ (1|FEMALE) + (YEAR) ,
na.action='na.omit', REML = T,
control = lmerControl(
sparseX = T),
data = BV.HSIdentical.df[,c("YEAR","FIELD","MALE","FEMALE","feature","LINE")] )
# 136
# 1026
summary(DIBV)
Blup = ranef(DIBV)
Blup=data.frame(Blup)
Blup = Blup %>% filter(grpvar != "MALE")
Blup = Blup %>% filter(grpvar != "LINE")
Blup.index = order(Blup$condval, decreasing=T)
Blup = Blup[Blup.index,]
head(Blup,10)
BV.HSIdentical.df = fread(paste0(hdp,"BV.HSIdentical.df.csv"))
name="Yield"
#lmerBV = function(){
######################################################
BV.HSIdentical.df = BV.HSIdentical.df %>% filter(Plot.Discarded != "Yes",
Plot.Status != "3 - Bad" )
BV.HSIdentical.df.expmean = aggregate(BV.HSIdentical.df[,"Yield"],
list(BV.HSIdentical.df$FEMALE),
mean,na.rm=T)
# #bv.mean = mean(BV.HSIdentical.df$Yield,na.rm=T)
colnames(BV.HSIdentical.df.expmean) = c("FEMALE","Yieldmean")
BV.HSIdentical.df = left_join(BV.HSIdentical.df, BV.HSIdentical.df.expmean, by="FEMALE" )
#BV.HSIdentical.df$Yieldmean = NA
BV.HSIdentical.df$Yield = ifelse(is.na(BV.HSIdentical.df$Yield), BV.HSIdentical.df$Yieldmean,BV.HSIdentical.df$Yield)
BV.HSIdentical.df = data.frame(BV.HSIdentical.df)
BV.HSIdentical.df$feature = BV.HSIdentical.df[,name]
male.rmdups = data.frame(inbred = BV.HSIdentical.df[!duplicated(BV.HSIdentical.df$MALE), c("MALE","LINE" )] )
female.rmdups = data.frame(inbred = BV.HSIdentical.df[!duplicated(BV.HSIdentical.df$FEMALE), c("FEMALE","LINE" )] )
#
#   totalInbreds = rbind(male.rmdups, female.rmdups)
# totalInbreds = data.frame(totalInbreds)
# totalInbreds = totalInbreds[!duplicated(totalInbreds$inbred),]
# totalInbreds = data.frame(totalInbreds)
maleinbreds = anti_join(male.rmdups,female.rmdups)
maleinbreds.2 = anti_join(male.rmdups,maleinbreds)
malesubset <- BV.HSIdentical.df[which(BV.HSIdentical.df$MALE %in% maleinbreds$inbred.MALE),]
#femalesubset.2 <- BV.HSIdentical.df[which(BV.HSIdentical.df$FEMALE %in% femaleinbreds.2$inbred.FEMALE),]
BV.HSIdentical.df.2 = BV.HSIdentical.df[,c(1:29,31,30,32:35)]
colnames(BV.HSIdentical.df.2)[c(30:31)] = c("MALE","FEMALE")
BV.HSIdentical.df = rbind(BV.HSIdentical.df.2,BV.HSIdentical.df)
BV.HSIdentical.df = data.frame(BV.HSIdentical.df)
FEMALE = length(levels(as.factor(BV.HSIdentical.df$FEMALE)))
MALE = length(levels(as.factor(BV.HSIdentical.df$MALE)))
p95 <- quantile(BV.HSIdentical.df$feature, 0.99, na.rm=T)
p05 <- quantile(BV.HSIdentical.df$feature, 0.01, na.rm=T)
# BV.HSIdentical.df <- BV.HSIdentical.df %>% filter(feature <= p95,
#                                                   feature >= p05)
DIBV = lmer(formula = feature ~ (1|FEMALE) + (YEAR) ,
na.action='na.omit', REML = T,
control = lmerControl(
sparseX = T),
data = BV.HSIdentical.df[,c("YEAR","FIELD","MALE","FEMALE","feature","LINE")] )
# 136
# 1026
summary(DIBV)
Blup = ranef(DIBV)
Blup=data.frame(Blup)
Blup = Blup %>% filter(grpvar != "MALE")
Blup = Blup %>% filter(grpvar != "LINE")
Blup.index = order(Blup$condval, decreasing=T)
Blup = Blup[Blup.index,]
head(Blup,10)
#Blup = aggregate
BV.HSIdentical.df = fread(paste0(hdp,"BV.HSIdentical.df.csv"))
name="Yield"
#lmerBV = function(){
######################################################
BV.HSIdentical.df = BV.HSIdentical.df %>% filter(Plot.Discarded != "Yes",
Plot.Status != "3 - Bad" )
BV.HSIdentical.df.expmean = aggregate(BV.HSIdentical.df[,"Yield"],
list(BV.HSIdentical.df$FEMALE),
mean,na.rm=T)
# #bv.mean = mean(BV.HSIdentical.df$Yield,na.rm=T)
colnames(BV.HSIdentical.df.expmean) = c("FEMALE","Yieldmean")
BV.HSIdentical.df = left_join(BV.HSIdentical.df, BV.HSIdentical.df.expmean, by="FEMALE" )
#BV.HSIdentical.df$Yieldmean = NA
BV.HSIdentical.df$Yield = ifelse(is.na(BV.HSIdentical.df$Yield), BV.HSIdentical.df$Yieldmean,BV.HSIdentical.df$Yield)
BV.HSIdentical.df = data.frame(BV.HSIdentical.df)
BV.HSIdentical.df$feature = BV.HSIdentical.df[,name]
male.rmdups = data.frame(inbred = BV.HSIdentical.df[!duplicated(BV.HSIdentical.df$MALE), c("MALE","LINE" )] )
female.rmdups = data.frame(inbred = BV.HSIdentical.df[!duplicated(BV.HSIdentical.df$FEMALE), c("FEMALE","LINE" )] )
#
#   totalInbreds = rbind(male.rmdups, female.rmdups)
# totalInbreds = data.frame(totalInbreds)
# totalInbreds = totalInbreds[!duplicated(totalInbreds$inbred),]
# totalInbreds = data.frame(totalInbreds)
maleinbreds = anti_join(male.rmdups,female.rmdups)
maleinbreds.2 = anti_join(male.rmdups,maleinbreds)
malesubset <- BV.HSIdentical.df[which(BV.HSIdentical.df$MALE %in% maleinbreds$inbred.MALE),]
#femalesubset.2 <- BV.HSIdentical.df[which(BV.HSIdentical.df$FEMALE %in% femaleinbreds.2$inbred.FEMALE),]
BV.HSIdentical.df.2 = BV.HSIdentical.df[,c(1:29,31,30,32:35)]
colnames(BV.HSIdentical.df.2)[c(30:31)] = c("MALE","FEMALE")
#BV.HSIdentical.df = rbind(BV.HSIdentical.df.2,BV.HSIdentical.df)
BV.HSIdentical.df = data.frame(BV.HSIdentical.df)
FEMALE = length(levels(as.factor(BV.HSIdentical.df$FEMALE)))
MALE = length(levels(as.factor(BV.HSIdentical.df$MALE)))
p95 <- quantile(BV.HSIdentical.df$feature, 0.99, na.rm=T)
p05 <- quantile(BV.HSIdentical.df$feature, 0.01, na.rm=T)
# BV.HSIdentical.df <- BV.HSIdentical.df %>% filter(feature <= p95,
#                                                   feature >= p05)
DIBV = lmer(formula = feature ~ (1|FEMALE) + (YEAR) ,
na.action='na.omit', REML = T,
control = lmerControl(
sparseX = T),
data = BV.HSIdentical.df[,c("YEAR","FIELD","MALE","FEMALE","feature","LINE")] )
# 136
# 1026
summary(DIBV)
Blup = ranef(DIBV)
Blup=data.frame(Blup)
Blup = Blup %>% filter(grpvar != "MALE")
Blup = Blup %>% filter(grpvar != "LINE")
Blup.index = order(Blup$condval, decreasing=T)
Blup = Blup[Blup.index,]
head(Blup,10)
#Blup = aggregate
BV.HSIdentical.df = fread(paste0(hdp,"BV.HSIdentical.df.csv"))
name="Yield"
#lmerBV = function(){
######################################################
BV.HSIdentical.df = BV.HSIdentical.df %>% filter(Plot.Discarded != "Yes",
Plot.Status != "3 - Bad" )
BV.HSIdentical.df.expmean = aggregate(BV.HSIdentical.df[,"Yield"],
list(BV.HSIdentical.df$FEMALE),
mean,na.rm=T)
# #bv.mean = mean(BV.HSIdentical.df$Yield,na.rm=T)
colnames(BV.HSIdentical.df.expmean) = c("FEMALE","Yieldmean")
BV.HSIdentical.df = left_join(BV.HSIdentical.df, BV.HSIdentical.df.expmean, by="FEMALE" )
#BV.HSIdentical.df$Yieldmean = NA
BV.HSIdentical.df$Yield = ifelse(is.na(BV.HSIdentical.df$Yield), BV.HSIdentical.df$Yieldmean,BV.HSIdentical.df$Yield)
BV.HSIdentical.df = data.frame(BV.HSIdentical.df)
BV.HSIdentical.df$feature = BV.HSIdentical.df[,name]
male.rmdups = data.frame(inbred = BV.HSIdentical.df[!duplicated(BV.HSIdentical.df$MALE), c("MALE","LINE" )] )
female.rmdups = data.frame(inbred = BV.HSIdentical.df[!duplicated(BV.HSIdentical.df$FEMALE), c("FEMALE","LINE" )] )
#
#   totalInbreds = rbind(male.rmdups, female.rmdups)
# totalInbreds = data.frame(totalInbreds)
# totalInbreds = totalInbreds[!duplicated(totalInbreds$inbred),]
# totalInbreds = data.frame(totalInbreds)
maleinbreds = anti_join(male.rmdups,female.rmdups)
maleinbreds.2 = anti_join(male.rmdups,maleinbreds)
malesubset <- BV.HSIdentical.df[which(BV.HSIdentical.df$MALE %in% maleinbreds$inbred.MALE),]
#femalesubset.2 <- BV.HSIdentical.df[which(BV.HSIdentical.df$FEMALE %in% femaleinbreds.2$inbred.FEMALE),]
BV.HSIdentical.df.2 = BV.HSIdentical.df[,c(1:29,31,30,32:35)]
colnames(BV.HSIdentical.df.2)[c(30:31)] = c("MALE","FEMALE")
#BV.HSIdentical.df = rbind(BV.HSIdentical.df.2,BV.HSIdentical.df)
BV.HSIdentical.df = data.frame(BV.HSIdentical.df)
